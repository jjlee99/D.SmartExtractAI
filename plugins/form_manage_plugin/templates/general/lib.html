{% import 'appbuilder/baselib.html' as baselib %}
{% import 'appbuilder/general/lib.html' as genlib %}

{% macro render_list_header(can_add, page, page_size, count, actions, modelview_name) %}
    {{ genlib.render_pagination(page, page_size, count, modelview_name) }}
    {{ genlib.render_set_page_size(page, page_size, count, modelview_name) }}
    {% if can_add %}
        {% set endpoint = modelview_name + '.add' %}
        {% set path = endpoint | safe_url_for %}
        {% if path %}
            {{ genlib.lnk_add(path) }}
        {% endif %}
    {% endif %}
    {{ genlib.render_actions(actions, modelview_name) }}
    {{ genlib.lnk_back() }}
    <div class="pull-right">
        <strong>{{ _('Record Count') }}:</strong> {{ count }}
    </div>
{% endmacro %}

{% macro render_custom_page_jump(page, page_size, count, modelview_name, page_step=25) %}
    {# ì „ì²´ í˜ì´ì§€ ìˆ˜ ê³„ì‚° #}
    {% set total_pages = ((count / page_size)|round(0,'ceil')|int) %}

    {# ì „ì²´ í˜ì´ì§€ê°€ page_step(25)ë³´ë‹¤ ì‘ê±°ë‚˜ 1í˜ì´ì§€ë©´ ë“œë¡­ë‹¤ìš´ í‘œì‹œ ì•ˆ í•¨ #}
    {% if total_pages > page_step %}
    <div class="btn-group dropup" style="margin-left: 5px;">
        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{_('í˜ì´ì§€')}} <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
            {% set current_page_jump = 0 %}
            {# iëŠ” 1ë¶€í„° ì‹œì‘í•˜ë©°, total_pages / page_step + 1íšŒ ë°˜ë³µ (í•„ìš”í•œ ìµœëŒ€ íšŸìˆ˜) #}
            {% for i in range(1, (total_pages // page_step) + 2) %}
                {% set target_page_num = i * page_step %}

                {# ë§ˆì§€ë§‰ í˜ì´ì§€ëŠ” total_pagesë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì¡°ì • #}
                {% if target_page_num > total_pages %}
                    {% set target_page_num = total_pages %}
                {% endif %}

                {# ì¤‘ë³µ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ í”¼í•˜ê³ , 1í˜ì´ì§€ë§Œ ì í”„ ì˜µì…˜ì— ì¶”ê°€ #}
                {% if target_page_num > current_page_jump and target_page_num > 1 %}
                    {# Flask-AppBuilderì˜ link_page í•„í„°ëŠ” lib.htmlì—ì„œ ì„í¬íŠ¸í•œ genlibì„ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤ #}
                    {% set url = target_page_num - 1 | link_page(modelview_name) %}
                    <li {% if (target_page_num - 1) == page %}class="active"{% endif %}>
                        <a href="{{ url }}">{{ target_page_num }}</a>
                    </li>
                    {% set current_page_jump = target_page_num %}
                {% endif %}

                {# ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë„ë‹¬í–ˆìœ¼ë©´ ë°˜ë³µ ì¤‘ë‹¨ #}
                {% if target_page_num == total_pages %}
                   
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endmacro %}

{% macro render_fixed_page_size(page, page_size, count, modelview_name) %}
{% if not page %} {% set page = 0 %} {% endif %}
{% set pages = ((count / page_size)|round(0,'ceil')|int)%}
{# pages > 1 ì¡°ê±´ì€ ìœ ì§€í•˜ì—¬ 1í˜ì´ì§€ì¼ ë•ŒëŠ” ë“œë¡­ë‹¤ìš´ì„ ìˆ¨ê¹€ #}

{# {% if pages > 1 %} #}
{% if count > 0 %} 
<div class="btn-group">
<button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
    {{_('Page size')}}<span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
        {% for sel_page_size in range(25,125,25) %}
            {# ğŸš¨ ì›ë³¸ì˜ ì¡°ê±´ë¬¸ (page*sel_page_size <= count)ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤. #}
            {% if sel_page_size == page_size %}
                <li class="active"><a href="{{sel_page_size | link_page_size(modelview_name) }}">{{sel_page_size}}</a></li>
            {% else %}
                {# link_page_size í•„í„°ëŠ” genlibì—ì„œ ì™”ìœ¼ë¯€ë¡œ, genlib. ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤. #}
                <li><a href="{{sel_page_size | link_page_size(modelview_name) }}">{{sel_page_size}}</a></li>
            {% endif %}
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endmacro %}



{% macro btn_crud(can_show, can_edit, can_delete, pk, modelview_name) %}
    <div class="btn-group btn-group-xs" style="display: flex;">
        {% if can_show %}
            {% set endpoint = modelview_name + '.show' %}
            {% set path = endpoint | safe_url_for(pk=pk) %}
            {% if path %}
                {{ genlib.lnk_show(path) }}
            {% endif %}
        {% endif %}
        {% if can_edit %}
            {% set endpoint = modelview_name + '.edit' %}
            {% set path = endpoint | safe_url_for(pk=pk) %}
            {% if path %}
                {{ genlib.lnk_edit(path) }}
            {% endif %}
        {% endif %}
        {% if can_delete %}
            {% set endpoint = modelview_name + '.delete' %}
            {% set path = endpoint | safe_url_for(pk=pk) %}
            {% if path %}
                {{ genlib.lnk_delete(path) }}
            {% endif %}
        {% endif %}
    </div>
{% endmacro %}

{% macro lnk_separate_area(my_href) %}
    <a href="{{my_href}}" class="btn btn-sm btn-default" data-toggle="tooltip" rel="tooltip"
       title="{{_('êµ¬ì—­ë¶„ë¦¬')}}">
        <span class="sr-only">{{ _('êµ¬ì—­ë¶„ë¦¬') }}</span>
        <i class="fas fa-expand"></i>
    </a>
{% endmacro %}
{% macro lnk_separate_block(my_href) %}
    <a href="{{my_href}}" class="btn btn-sm btn-default" data-toggle="tooltip" rel="tooltip"
       title="{{_('ë¸”ë¡ë§¤í•‘')}}">
        <span class="sr-only">{{ _('ë¸”ë¡ë§¤í•‘') }}</span>
        <i class="fas fa-th"></i>
    </a>
{% endmacro %}
